{"version":3,"file":"RectangleGeometryLibrary-6e94f1ef.js","sources":["../../../../Source/Core/RectangleGeometryLibrary.js"],"sourcesContent":["import Cartesian3 from \"./Cartesian3.js\";\nimport Cartographic from \"./Cartographic.js\";\nimport defined from \"./defined.js\";\nimport DeveloperError from \"./DeveloperError.js\";\nimport GeographicProjection from \"./GeographicProjection.js\";\nimport CesiumMath from \"./Math.js\";\nimport Matrix2 from \"./Matrix2.js\";\nimport Rectangle from \"./Rectangle.js\";\n\nvar cos = Math.cos;\nvar sin = Math.sin;\nvar sqrt = Math.sqrt;\n\n/**\n * @private\n */\nvar RectangleGeometryLibrary = {};\n\n/**\n * @private\n */\nRectangleGeometryLibrary.computePosition = function (\n  computedOptions,\n  ellipsoid,\n  computeST,\n  row,\n  col,\n  position,\n  st\n) {\n  var radiiSquared = ellipsoid.radiiSquared;\n  var nwCorner = computedOptions.nwCorner;\n  var rectangle = computedOptions.boundingRectangle;\n\n  var stLatitude =\n    nwCorner.latitude -\n    computedOptions.granYCos * row +\n    col * computedOptions.granXSin;\n  var cosLatitude = cos(stLatitude);\n  var nZ = sin(stLatitude);\n  var kZ = radiiSquared.z * nZ;\n\n  var stLongitude =\n    nwCorner.longitude +\n    row * computedOptions.granYSin +\n    col * computedOptions.granXCos;\n  var nX = cosLatitude * cos(stLongitude);\n  var nY = cosLatitude * sin(stLongitude);\n\n  var kX = radiiSquared.x * nX;\n  var kY = radiiSquared.y * nY;\n\n  var gamma = sqrt(kX * nX + kY * nY + kZ * nZ);\n\n  position.x = kX / gamma;\n  position.y = kY / gamma;\n  position.z = kZ / gamma;\n\n  if (computeST) {\n    var stNwCorner = computedOptions.stNwCorner;\n    if (defined(stNwCorner)) {\n      stLatitude =\n        stNwCorner.latitude -\n        computedOptions.stGranYCos * row +\n        col * computedOptions.stGranXSin;\n      stLongitude =\n        stNwCorner.longitude +\n        row * computedOptions.stGranYSin +\n        col * computedOptions.stGranXCos;\n\n      st.x = (stLongitude - computedOptions.stWest) * computedOptions.lonScalar;\n      st.y = (stLatitude - computedOptions.stSouth) * computedOptions.latScalar;\n    } else {\n      st.x = (stLongitude - rectangle.west) * computedOptions.lonScalar;\n      st.y = (stLatitude - rectangle.south) * computedOptions.latScalar;\n    }\n  }\n};\n\nvar rotationMatrixScratch = new Matrix2();\nvar nwCartesian = new Cartesian3();\nvar centerScratch = new Cartographic();\nvar centerCartesian = new Cartesian3();\nvar proj = new GeographicProjection();\n\nfunction getRotationOptions(\n  nwCorner,\n  rotation,\n  granularityX,\n  granularityY,\n  center,\n  width,\n  height\n) {\n  var cosRotation = Math.cos(rotation);\n  var granYCos = granularityY * cosRotation;\n  var granXCos = granularityX * cosRotation;\n\n  var sinRotation = Math.sin(rotation);\n  var granYSin = granularityY * sinRotation;\n  var granXSin = granularityX * sinRotation;\n\n  nwCartesian = proj.project(nwCorner, nwCartesian);\n\n  nwCartesian = Cartesian3.subtract(nwCartesian, centerCartesian, nwCartesian);\n  var rotationMatrix = Matrix2.fromRotation(rotation, rotationMatrixScratch);\n  nwCartesian = Matrix2.multiplyByVector(\n    rotationMatrix,\n    nwCartesian,\n    nwCartesian\n  );\n  nwCartesian = Cartesian3.add(nwCartesian, centerCartesian, nwCartesian);\n  nwCorner = proj.unproject(nwCartesian, nwCorner);\n\n  width -= 1;\n  height -= 1;\n\n  var latitude = nwCorner.latitude;\n  var latitude0 = latitude + width * granXSin;\n  var latitude1 = latitude - granYCos * height;\n  var latitude2 = latitude - granYCos * height + width * granXSin;\n\n  var north = Math.max(latitude, latitude0, latitude1, latitude2);\n  var south = Math.min(latitude, latitude0, latitude1, latitude2);\n\n  var longitude = nwCorner.longitude;\n  var longitude0 = longitude + width * granXCos;\n  var longitude1 = longitude + height * granYSin;\n  var longitude2 = longitude + height * granYSin + width * granXCos;\n\n  var east = Math.max(longitude, longitude0, longitude1, longitude2);\n  var west = Math.min(longitude, longitude0, longitude1, longitude2);\n\n  return {\n    north: north,\n    south: south,\n    east: east,\n    west: west,\n    granYCos: granYCos,\n    granYSin: granYSin,\n    granXCos: granXCos,\n    granXSin: granXSin,\n    nwCorner: nwCorner,\n  };\n}\n\n/**\n * @private\n */\nRectangleGeometryLibrary.computeOptions = function (\n  rectangle,\n  granularity,\n  rotation,\n  stRotation,\n  boundingRectangleScratch,\n  nwCornerResult,\n  stNwCornerResult\n) {\n  var east = rectangle.east;\n  var west = rectangle.west;\n  var north = rectangle.north;\n  var south = rectangle.south;\n\n  var northCap = false;\n  var southCap = false;\n\n  if (north === CesiumMath.PI_OVER_TWO) {\n    northCap = true;\n  }\n  if (south === -CesiumMath.PI_OVER_TWO) {\n    southCap = true;\n  }\n\n  var width;\n  var height;\n  var granularityX;\n  var granularityY;\n  var dx;\n  var dy = north - south;\n  if (west > east) {\n    dx = CesiumMath.TWO_PI - west + east;\n  } else {\n    dx = east - west;\n  }\n\n  width = Math.ceil(dx / granularity) + 1;\n  height = Math.ceil(dy / granularity) + 1;\n  granularityX = dx / (width - 1);\n  granularityY = dy / (height - 1);\n\n  var nwCorner = Rectangle.northwest(rectangle, nwCornerResult);\n  var center = Rectangle.center(rectangle, centerScratch);\n  if (rotation !== 0 || stRotation !== 0) {\n    if (center.longitude < nwCorner.longitude) {\n      center.longitude += CesiumMath.TWO_PI;\n    }\n    centerCartesian = proj.project(center, centerCartesian);\n  }\n\n  var granYCos = granularityY;\n  var granXCos = granularityX;\n  var granYSin = 0.0;\n  var granXSin = 0.0;\n\n  var boundingRectangle = Rectangle.clone(rectangle, boundingRectangleScratch);\n\n  var computedOptions = {\n    granYCos: granYCos,\n    granYSin: granYSin,\n    granXCos: granXCos,\n    granXSin: granXSin,\n    nwCorner: nwCorner,\n    boundingRectangle: boundingRectangle,\n    width: width,\n    height: height,\n    northCap: northCap,\n    southCap: southCap,\n  };\n\n  if (rotation !== 0) {\n    var rotationOptions = getRotationOptions(\n      nwCorner,\n      rotation,\n      granularityX,\n      granularityY,\n      center,\n      width,\n      height\n    );\n    north = rotationOptions.north;\n    south = rotationOptions.south;\n    east = rotationOptions.east;\n    west = rotationOptions.west;\n\n    //>>includeStart('debug', pragmas.debug);\n    if (\n      north < -CesiumMath.PI_OVER_TWO ||\n      north > CesiumMath.PI_OVER_TWO ||\n      south < -CesiumMath.PI_OVER_TWO ||\n      south > CesiumMath.PI_OVER_TWO\n    ) {\n      throw new DeveloperError(\n        \"Rotated rectangle is invalid.  It crosses over either the north or south pole.\"\n      );\n    }\n    //>>includeEnd('debug')\n\n    computedOptions.granYCos = rotationOptions.granYCos;\n    computedOptions.granYSin = rotationOptions.granYSin;\n    computedOptions.granXCos = rotationOptions.granXCos;\n    computedOptions.granXSin = rotationOptions.granXSin;\n\n    boundingRectangle.north = north;\n    boundingRectangle.south = south;\n    boundingRectangle.east = east;\n    boundingRectangle.west = west;\n  }\n\n  if (stRotation !== 0) {\n    rotation = rotation - stRotation;\n    var stNwCorner = Rectangle.northwest(boundingRectangle, stNwCornerResult);\n\n    var stRotationOptions = getRotationOptions(\n      stNwCorner,\n      rotation,\n      granularityX,\n      granularityY,\n      center,\n      width,\n      height\n    );\n\n    computedOptions.stGranYCos = stRotationOptions.granYCos;\n    computedOptions.stGranXCos = stRotationOptions.granXCos;\n    computedOptions.stGranYSin = stRotationOptions.granYSin;\n    computedOptions.stGranXSin = stRotationOptions.granXSin;\n    computedOptions.stNwCorner = stNwCorner;\n    computedOptions.stWest = stRotationOptions.west;\n    computedOptions.stSouth = stRotationOptions.south;\n  }\n\n  return computedOptions;\n};\nexport default RectangleGeometryLibrary;\n"],"names":["cos","Math","sin","sqrt","RectangleGeometryLibrary","computePosition","computedOptions","ellipsoid","computeST","row","col","position","st","stNwCorner","radiiSquared","nwCorner","rectangle","boundingRectangle","stLatitude","latitude","granYCos","granXSin","cosLatitude","nZ","kZ","z","stLongitude","longitude","granYSin","granXCos","nX","nY","kX","x","kY","y","gamma","defined","stGranYCos","stGranXSin","stGranYSin","stGranXCos","stWest","lonScalar","stSouth","latScalar","west","south","rotationMatrixScratch","Matrix2","nwCartesian","Cartesian3","centerScratch","Cartographic","centerCartesian","proj","GeographicProjection","getRotationOptions","rotation","granularityX","granularityY","center","width","height","cosRotation","sinRotation","project","subtract","rotationMatrix","fromRotation","multiplyByVector","add","unproject","latitude0","latitude1","latitude2","north","max","min","longitude0","longitude1","longitude2","east","computeOptions","granularity","stRotation","boundingRectangleScratch","nwCornerResult","stNwCornerResult","northCap","southCap","CesiumMath","PI_OVER_TWO","dx","dy","TWO_PI","ceil","Rectangle","northwest","stRotationOptions","clone","rotationOptions","DeveloperError"],"mappings":"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"}