define(["exports","./when-54c2dc71","./Check-6c0211bc","./Math-1124a290","./Cartesian2-36f5627e","./Transforms-441ed215","./IntersectionTests-332df314","./Plane-2a7715fd","./EllipsoidRhumbLine-f66c71e3","./EllipsoidGeodesic-8db9ab41"],function(a,w,P,T,y,v,m,A,E,e){"use strict";var b={numberOfPoints:function(a,e,r){var t=y.Cartesian3.distance(a,e);return Math.ceil(t/r)},numberOfPointsRhumbLine:function(a,e,r){var t=Math.pow(a.longitude-e.longitude,2)+Math.pow(a.latitude-e.latitude,2);return Math.ceil(Math.sqrt(t/(r*r)))}},o=new y.Cartographic;b.extractHeights=function(a,e){for(var r=a.length,t=new Array(r),i=0;i<r;i++){var n=a[i];t[i]=e.cartesianToCartographic(n,o).height}return t};var R=new v.Matrix4,S=new y.Cartesian3,D=new y.Cartesian3,M=new A.Plane(y.Cartesian3.UNIT_X,0),x=new y.Cartesian3,N=new A.Plane(y.Cartesian3.UNIT_X,0),G=new y.Cartesian3,I=new y.Cartesian3,k=[];function V(a,e,r){var t=k;if(t.length=a,e===r){for(n=0;n<a;n++)t[n]=e;return t}for(var i=(r-e)/a,n=0;n<a;n++){var o=e+n*i;t[n]=o}return t}var L=new y.Cartographic,_=new y.Cartographic,O=new y.Cartesian3,B=new y.Cartesian3,U=new y.Cartesian3,q=new e.EllipsoidGeodesic,z=new E.EllipsoidRhumbLine;b.wrapLongitude=function(a,e){var r=[],t=[];if(w.defined(a)&&0<a.length){e=w.defaultValue(e,v.Matrix4.IDENTITY);var i=v.Matrix4.inverseTransformation(e,R),n=v.Matrix4.multiplyByPoint(i,y.Cartesian3.ZERO,S),o=y.Cartesian3.normalize(v.Matrix4.multiplyByPointAsVector(i,y.Cartesian3.UNIT_Y,D),D),s=A.Plane.fromPointNormal(n,o,M),c=y.Cartesian3.normalize(v.Matrix4.multiplyByPointAsVector(i,y.Cartesian3.UNIT_X,x),x),l=A.Plane.fromPointNormal(n,c,N),u=1;r.push(y.Cartesian3.clone(a[0]));for(var h=r[0],f=a.length,d=1;d<f;++d){var p,g,C=a[d];(A.Plane.getPointDistance(l,h)<0||A.Plane.getPointDistance(l,C)<0)&&(p=m.IntersectionTests.lineSegmentPlane(h,C,s,G),w.defined(p)&&(g=y.Cartesian3.multiplyByScalar(o,5e-9,I),A.Plane.getPointDistance(s,h)<0&&y.Cartesian3.negate(g,g),r.push(y.Cartesian3.add(p,g,new y.Cartesian3)),t.push(u+1),y.Cartesian3.negate(g,g),r.push(y.Cartesian3.add(p,g,new y.Cartesian3)),u=1)),r.push(y.Cartesian3.clone(a[d])),u++,h=C}t.push(u)}return{positions:r,lengths:t}},b.generateArc=function(a){w.defined(a)||(a={});var e=a.positions;if(!w.defined(e))throw new P.DeveloperError("options.positions is required.");var r=e.length,t=w.defaultValue(a.ellipsoid,y.Ellipsoid.WGS84),i=w.defaultValue(a.height,0),n=Array.isArray(i);if(r<1)return[];if(1===r){var o,s=t.scaleToGeodeticSurface(e[0],B);return 0!==(i=n?i[0]:i)&&(o=t.geodeticSurfaceNormal(s,O),y.Cartesian3.multiplyByScalar(o,i,o),y.Cartesian3.add(s,o,s)),[s.x,s.y,s.z]}var c,l=a.minDistance;w.defined(l)||(c=w.defaultValue(a.granularity,T.CesiumMath.RADIANS_PER_DEGREE),l=T.CesiumMath.chordLength(c,t.maximumRadius));for(var u=0,h=0;h<r-1;h++)u+=b.numberOfPoints(e[h],e[h+1],l);var f=3*(u+1),d=new Array(f),p=0;for(h=0;h<r-1;h++)p=function(a,e,r,t,i,n,o,s){var c=t.scaleToGeodeticSurface(a,B),l=t.scaleToGeodeticSurface(e,U),u=b.numberOfPoints(a,e,r),h=t.cartesianToCartographic(c,L),f=t.cartesianToCartographic(l,_),d=V(u,i,n);q.setEndPoints(h,f);var p=q.surfaceDistance/u,g=s;h.height=i;var C=t.cartographicToCartesian(h,O);y.Cartesian3.pack(C,o,g),g+=3;for(var v=1;v<u;v++){var m=q.interpolateUsingSurfaceDistance(v*p,_);m.height=d[v],C=t.cartographicToCartesian(m,O),y.Cartesian3.pack(C,o,g),g+=3}return g}(e[h],e[h+1],l,t,n?i[h]:i,n?i[h+1]:i,d,p);k.length=0;var g=e[r-1],C=t.cartesianToCartographic(g,L);C.height=n?i[r-1]:i;var v=t.cartographicToCartesian(C,O);return y.Cartesian3.pack(v,d,f-3),d};var X=new y.Cartographic,W=new y.Cartographic;b.generateRhumbArc=function(a){w.defined(a)||(a={});var e=a.positions;if(!w.defined(e))throw new P.DeveloperError("options.positions is required.");var r=e.length,t=w.defaultValue(a.ellipsoid,y.Ellipsoid.WGS84),i=w.defaultValue(a.height,0),n=Array.isArray(i);if(r<1)return[];if(1===r){var o,s=t.scaleToGeodeticSurface(e[0],B);return 0!==(i=n?i[0]:i)&&(o=t.geodeticSurfaceNormal(s,O),y.Cartesian3.multiplyByScalar(o,i,o),y.Cartesian3.add(s,o,s)),[s.x,s.y,s.z]}for(var c,l=w.defaultValue(a.granularity,T.CesiumMath.RADIANS_PER_DEGREE),u=0,h=t.cartesianToCartographic(e[0],X),f=0;f<r-1;f++)c=t.cartesianToCartographic(e[f+1],W),u+=b.numberOfPointsRhumbLine(h,c,l),h=y.Cartographic.clone(c,X);var d=3*(u+1),p=new Array(d),g=0;for(f=0;f<r-1;f++)g=function(a,e,r,t,i,n,o,s){var c=t.cartesianToCartographic(a,L),l=t.cartesianToCartographic(e,_),u=b.numberOfPointsRhumbLine(c,l,r);c.height=0,l.height=0;var h=V(u,i,n);z.ellipsoid.equals(t)||(z=new E.EllipsoidRhumbLine(void 0,void 0,t)),z.setEndPoints(c,l);var f=z.surfaceDistance/u,d=s;c.height=i;var p=t.cartographicToCartesian(c,O);y.Cartesian3.pack(p,o,d),d+=3;for(var g=1;g<u;g++){var C=z.interpolateUsingSurfaceDistance(g*f,_);C.height=h[g],p=t.cartographicToCartesian(C,O),y.Cartesian3.pack(p,o,d),d+=3}return d}(e[f],e[f+1],l,t,n?i[f]:i,n?i[f+1]:i,p,g);k.length=0;var C=e[r-1],v=t.cartesianToCartographic(C,L);v.height=n?i[r-1]:i;var m=t.cartographicToCartesian(v,O);return y.Cartesian3.pack(m,p,d-3),p},b.generateCartesianArc=function(a){for(var e=b.generateArc(a),r=e.length/3,t=new Array(r),i=0;i<r;i++)t[i]=y.Cartesian3.unpack(e,3*i);return t},b.generateCartesianRhumbArc=function(a){for(var e=b.generateRhumbArc(a),r=e.length/3,t=new Array(r),i=0;i<r;i++)t[i]=y.Cartesian3.unpack(e,3*i);return t},a.PolylinePipeline=b});
//# sourceMappingURL=PolylinePipeline-40aa9043.js.map
